---
layout: post
title: '221114'
subtitle: '221114'
categories: til
comments: false
---

1. [pypika알아보기](https://github.com/kayak/pypika)   

2. 현재 진행하고 있는 프로젝트에 시퀀스 이슈가 있었다.  
    
파트너사 계정 추가할때 insert이슈로 시퀀스가 살짝 꼬이는 이슈 발생
그 뒤로  33(?)씩 시퀀스가 증가되는 문제가 발생   
근데 실제 디비 살펴보니 site_domain이라는 필드에 unique 부여하면서 시퀀스가 증가한것 같다.
site_domain 값은 null이여도 상관없지만 기존 코드에서는 null로 들어가야 하는 값이 "" 빈 문자열로 인식해 빈 문자열로 들어가면서 계정 생성시 unique 에러가 발생했고 해당 로직을 감싸고 있던 트랜잭션에서 롤백이 되었다. 이때 index는 +1이 추가되는 상황이 발생했다. 여기서 index가 1~2씩 차이가 날 수 있지만 33씩이나 증가되는 이유를 모르겠다. 해결은 어이없게 되서 더 찝찝하다.. 아놔 !!

```text
- 운영 파트너 어드민에서 계정 추가할때 시퀀스가 33씩 증가됨
- 데브 파트너 어드민에서는 정상적으로 +1 씩 증가됨
- 데브와 프로드 테이블 설정이 다른게 있는지 찾아봤지만 시퀀스 이슈가 될 만한건 없었음
- 찾아보니 cache_size라는 것이 있으며 해당 사이즈 이슈인건가 싶어 찾아보니 cache_size=1
- select nextval('tbl_partner_master_idx_seq') 해당 명령어로 다음 시퀀스값이 +1로 증가된거 확인
- 다시 운영 파트너 어드민에서 계정 추가해보니 시퀀스 정상적으로 +1씩 증가됨
- ?
```

아직 에러는 찾고 있는 중이다.. 분명 이유가 있을텐데 말이다...